<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>HR Leave Requests</title>

<!-- âœ… Bootstrap 5 CDN -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

<style>
/* ===== Base ===== */
body {
  font-family: Arial;
  background: #f4f6f9;
  padding: clamp(12px, 3vw, 30px);
}

h2 {
  margin-bottom: 20px;
  font-size: clamp(20px, 4vw, 28px);
}

/* ===== Card ===== */
.card {
  background: #000;
  color: white;
  padding: 18px;
  border-radius: 14px;
  margin-bottom: 20px;
  width: 100%;
  word-wrap: break-word;
}

.card h3 {
  margin-bottom: 4px;
  font-size: clamp(16px, 3.5vw, 20px);
}

/* ===== Text ===== */
.time {
  font-size: 13px;
  opacity: 0.8;
  margin-bottom: 6px;
}

.card p {
  font-size: clamp(14px, 3vw, 16px);
}

p, h3 {
  overflow-wrap: anywhere;
}

/* ===== Status ===== */
.status {
  display: inline-block;
  padding: 11px 16px;   
  border-radius: 20px;
  font-size: 15px;
  font-weight: bold;
  margin-bottom: 10px;
  width: fit-content; 
}


.pending { background: orange; color: black; }
.approved { background: #22c55e; color: black; }
.rejected { background: #ef4444; color: black; }

/* ===== Buttons ===== */
button {
  padding: 12px 14px;
  border: none;
  border-radius: 12px;
  cursor: pointer;
  margin-right: 6px;
  font-size: 16px;
}

.approve { background: #22c55e; color: white; }
.reject { background: #ef4444; color: white; }
.delete { background: #6b7280; color: white; }

/* ===== Mobile responsive ===== */
@media (max-width: 576px) {
  .card button {
    width: 100%;
    margin-bottom: 8px;
  }
}
</style>
</head>

<body>

<div class="container-fluid">
  <div class="row justify-content-center">
    <div class="col-12 col-md-10 col-lg-8">

      <h2 class="text-center text-md-start">HR Leave Requests</h2>
      <div id="leaveList"></div>

    </div>
  </div>
</div>

<script>
// ðŸ”¹ Format timestamp to date + time
function formatDateTime(ts) {
  if (!ts) return "-";
  return new Date(ts).toLocaleString();
}

// ðŸ”¹ "time ago" 
function timeAgo(ts) {
  if (!ts) return "";
  const diff = Date.now() - ts;
  const mins = Math.floor(diff / 60000);
  if (mins < 1) return "Just now";
  if (mins < 60) return `${mins} minute(s) ago`;
  const hrs = Math.floor(mins / 60);
  if (hrs < 24) return `${hrs} hour(s) ago`;
  return `${Math.floor(hrs / 24)} day(s) ago`;
}

function loadLeaves() {
  const list = document.getElementById("leaveList");
  list.innerHTML = "";

  const leaves = JSON.parse(localStorage.getItem("leaves")) || [];

  if (leaves.length === 0) {
    list.innerHTML = "<p>No leave requests found.</p>";
    return;
  }

  leaves.forEach((l, i) => {
    list.innerHTML += `
      <div class="card">
        <h3>${l.name || "Unknown Employee"}</h3>

        <div class="time">
          <b>Received:</b> ${formatDateTime(l.createdAt)}
          (${timeAgo(l.createdAt)})
        </div>

        ${
          l.actionAt
            ? `<div class="time">
                 <b>${l.status} on:</b> ${formatDateTime(l.actionAt)}
                 (${timeAgo(l.actionAt)})
               </div>`
            : ""
        }

        <p><b>Employee ID:</b> ${l.empId || "-"}</p>
        <p><b>Email:</b> ${l.email || "-"}</p>
        <p><b>Leave Dates:</b> ${l.start || "-"} â†’ ${l.end || "-"}</p>
        <p><b>Reason:</b> ${l.reason || "-"}</p>

        <span class="status ${(l.status || "Pending").toLowerCase()}">
          ${l.status || "Pending"}
        </span>

        <div class="mt-3">
          <button class="approve" onclick="updateStatus(${i}, 'Approved')">Approve</button>
          <button class="reject" onclick="updateStatus(${i}, 'Rejected')">Reject</button>
          <button class="delete" onclick="deleteLeave(${i})">Delete</button>
        </div>
      </div>
    `;
  });
}

// âœ… SAVE APPROVED / REJECTED TIME
function updateStatus(index, status) {
  const leaves = JSON.parse(localStorage.getItem("leaves")) || [];
  leaves[index].status = status;
  leaves[index].actionAt = Date.now();
  localStorage.setItem("leaves", JSON.stringify(leaves));
  loadLeaves();
}

function deleteLeave(index) {
  const leaves = JSON.parse(localStorage.getItem("leaves")) || [];
  leaves.splice(index, 1);
  localStorage.setItem("leaves", JSON.stringify(leaves));
  loadLeaves();
}

loadLeaves();
</script>

</body>
</html>
